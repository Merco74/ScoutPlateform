<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inscription - Scouts & Guides de Cluses</title>
  <link rel="stylesheet" href="/css/styles.css"/>
  <style>
    /* ... (ton style existant) ... */
    .container { max-width: 900px; margin: 2rem auto; padding: 1rem; font-family: Arial, sans-serif; }
    .section { margin: 2rem 0; padding: 1.5rem; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9; }
    .section h2 { margin-top: 0; color: #1a5fb4; font-size: 1.4rem; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
    input, select, textarea { width: 100%; padding: 0.6rem; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; }
    label { display: block; margin: 0.5rem 0; font-weight: bold; }
    .required { color: red; }
    .checkbox-group label { display: flex; align-items: center; font-weight: normal; }
    .checkbox-group input { width: auto; margin-right: 0.5rem; }
    .signature-pad { border: 2px dashed #aaa; border-radius: 8px; background: white; margin: 1rem 0; }
    button { background: #1a5fb4; color: white; padding: 1rem 2rem; font-size: 1.1rem; border: none; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 1rem; }
    button:hover { background: #0d47a1; }
    .success, .error { padding: 1rem; border-radius: 8px; margin-top: 1rem; }
    .success { background: #e8f5e9; color: green; }
    .error { background: #ffebee; color: red; }
    .cotisation { background: #fff3e0; padding: 1rem; border-left: 4px solid #ff9800; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h1 style="text-align: center; color: #1a5fb4;">Inscription Scouts & Guides de Cluses</h1>

    <form id="inscriptionForm" enctype="multipart/form-data">
      <!-- CATÉGORIE -->
      <div class="section">
        <h2>1. Catégorie <span class="required">*</span></h2>
        <select name="categorie" required>
          <option value="">Choisir...</option>
          <option value="scout">Scout</option>
          <option value="guide">Guide</option>
          <option value="louveteau">Louveteau</option>
        </select>
      </div>

      <!-- IDENTITÉ ENFANT -->
      <div class="section">
        <h2>2. Identité de l'enfant <span class="required">*</span></h2>
        <div class="form-grid">
          <div><label>Nom <span class="required">*</span></label><input type="text" name="nom" required></div>
          <div><label>Prénom <span class="required">*</span></label><input type="text" name="prenom" required></div>
          <div><label>Date de naissance <span class="required">*</span></label><input type="date" name="dateNaissance" required></div>
          <div><label>Âge <span class="required">*</span></label><input type="number" name="age" min="11" max="17" required></div>
          <div><label>Sexe <span class="required">*</span></label>
            <select name="sexe" required>
              <option value="">Choisir...</option>
              <option value="Masculin">Garçon</option>
              <option value="Féminin">Fille</option>
            </select>
          </div>
          <div><label>Ville <span class="required">*</span></label><input type="text" name="ville" required></div>
          <div><label>Code postal <span class="required">*</span></label><input type="text" name="codePostal" pattern="\d{5}" required></div>
          <div style="grid-column: span 2;"><label>Adresse <span class="required">*</span></label><input type="text" name="adresse" required></div>
          <div><label>Tél. portable <span class="required">*</span></label><input type="tel" name="telPortable" pattern="0[6-7]\d{8}" required></div>
          <div><label>Email</label><input type="email" name="email"></div>
          <div><label>Tél. domicile</label><input type="tel" name="telDomicile"></div>
        </div>
      </div>

      <!-- RESPONSABLES -->
      <div class="section">
        <h2>3. Responsables légaux</h2>
        <h3>Responsable 1 <span class="required">*</span></h3>
        <div class="form-grid">
          <div><label>Nom</label><input type="text" name="responsable1Nom" required></div>
          <div><label>Prénom</label><input type="text" name="responsable1Prenom" required></div>
          <div style="grid-column: span 2;"><label>Adresse</label><input type="text" name="responsable1Adresse" required></div>
          <div><label>Portable</label><input type="tel" name="responsable1TelPortable" pattern="0[6-7]\d{8}" required></div>
          <div><label>Domicile</label><input type="tel" name="responsable1TelDomicile"></div>
          <div><label>Travail</label><input type="tel" name="responsable1TelTravail"></div>
          <div><label>Email parental</label><input type="email" name="parentEmail" required></div>
        </div>

        <h3>Responsable 2</h3>
        <div class="form-grid">
          <div><label>Nom</label><input type="text" name="responsable2Nom"></div>
          <div><label>Prénom</label><input type="text" name="responsable2Prenom"></div>
          <div style="grid-column: span 2;"><label>Adresse</label><input type="text" name="responsable2Adresse"></div>
          <div><label>Portable</label><input type="tel" name="responsable2TelPortable"></div>
          <div><label>Domicile</label><input type="tel" name="responsable2TelDomicile"></div>
          <div><label>Travail</label><input type="tel" name="responsable2TelTravail"></div>
        </div>
      </div>

      <!-- CONTACT URGENCE -->
      <div class="section">
        <h2>4. Contact d'urgence <span class="required">*</span></h2>
        <div class="form-grid">
          <div><label>Nom</label><input type="text" name="contactUrgenceNom" required></div>
          <div><label>Prénom</label><input type="text" name="contactUrgencePrenom" required></div>
          <div><label>Tél.</label><input type="tel" name="contactUrgenceTel" required></div>
          <div><label>Sexe</label>
            <select name="contactUrgenceSexe" required>
              <option value="">...</option>
              <option value="Homme">Homme</option>
              <option value="Femme">Femme</option>
            </select>
          </div>
          <div style="grid-column: span 2;"><label>Lien</label>
            <select name="contactUrgenceLien" required>
              <option value="">...</option>
              <option value="Famille">Famille</option>
              <option value="Tuteur légal">Tuteur légal</option>
            </select>
          </div>
        </div>
      </div>

      <!-- AUTRE CLUB -->
      <div class="section">
        <h2>5. Autre club ?</h2>
        <label><input type="checkbox" name="autreClub"> Oui</label>
        <input type="text" name="nomAutreClub" placeholder="Nom du club">
      </div>

      <!-- SANITAIRE -->
      <div class="section">
        <h2>6. Fiche sanitaire</h2>
        <label><input type="checkbox" name="vaccinsObligatoires" checked> Vaccins obligatoires à jour</label>

        <h3>Vaccins recommandés</h3>
        <div class="form-grid">
          <div><input type="text" name="vaccinDiphtérie" value="OK" readonly></div>
          <div><input type="text" name="vaccinCoqueluche" value="OK" readonly></div>
          <div><input type="text" name="vaccinTétanos" value="OK" readonly></div>
          <div><input type="text" name="vaccinHaemophilus" value="OK" readonly></div>
          <div><input type="text" name="vaccinPoliomyélite" value="OK" readonly></div>
          <div><input type="text" name="vaccinRougeole" value="OK" readonly></div>
          <div><input type="text" name="vaccinPneumocoque" value="OK" readonly></div>
          <div><input type="text" name="vaccinBcg" value="OK" readonly></div>
        </div>
        <label>Autres :</label><input type="text" name="vaccinsAutres">

        <div class="checkbox-group">
          <label><input type="checkbox" name="traitementMedical"> Traitement</label>
          <label><input type="checkbox" name="allergiesAlimentaires"> Allergies alimentaires</label>
          <label><input type="checkbox" name="allergiesMedicament"> Allergies médicaments</label>
          <label><input type="checkbox" name="allergiesAutres"> Autres</label>
        </div>
        <textarea name="allergiesDetails" placeholder="Détails..."></textarea>

        <label><input type="checkbox" name="problemeSante"> Problème de santé</label>
        <textarea name="problemeSanteDetails" placeholder="Détails..."></textarea>

        <label>Médecin traitant :</label><input type="text" name="medecinTraitant">
      </div>

      <!-- DOCUMENTS -->
      <div class="section">
        <h2>7. Documents</h2>
        <label>Carnet vaccination <span class="required">*</span></label>
        <input type="file" name="vaccinScan" accept=".pdf,.jpg,.jpeg,.png" required>
        <label>Ordonnances</label><input type="file" name="medicationScan" accept=".pdf,.jpg,.jpeg,.png">
        <label>Autres</label><input type="file" name="otherDocuments" accept=".pdf,.jpg,.jpeg,.png" multiple>
      </div>

      <!-- AUTORISATIONS -->
      <div class="section">
        <h2>8. Autorisations <span class="required">*</span></h2>
        <div class="checkbox-group">
          <label><input type="checkbox" name="droitImage" required> Photos/vidéos</label>
          <label><input type="checkbox" name="droitDiffusion" required> Diffusion publique</label>
          <label><input type="checkbox" name="autorisationTransport" required> Transport véhicule</label>
        </div>
      </div>

      <!-- COTISATION -->
      <div class="section cotisation">
        <strong>Cotisation : 20 €</strong> par espèces, chèques ou virement bancaire. <br>
          Virement : FR76 1680 7000 3085 8868 0119 504<br>
          Confirmez par SMS à Mathéo le virement bancaire : 06.72.44.49.92
      </div>

      <!-- SIGNATURES -->
      <div class="section">
        <h2>9. Signature <span class="required">*</span></h2>
        <label>Autorisation & inscription</label>
        <canvas id="sig1" class="signature-pad" width="500" height="150"></canvas>
        <button type="button" onclick="clearSig('sig1')">Effacer</button>
        <input type="hidden" name="signatureDroitImage" id="sig1Data">

        <label style="margin-top: 1rem;">Fiche sanitaire</label>
        <canvas id="sig2" class="signature-pad" width="500" height="150"></canvas>
        <button type="button" onclick="clearSig('sig2')">Effacer</button>
        <input type="hidden" name="signatureSanitaire" id="sig2Data">
      </div>

      <button type="submit">Valider l'inscription</button>
    </form>

    <div id="result"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  <script>
    const pad1 = new SignaturePad(document.getElementById('sig1'));
    const pad2 = new SignaturePad(document.getElementById('sig2'));

    function clearSig(id) {
      if (id === 'sig1') pad1.clear();
      if (id === 'sig2') pad2.clear();
    }

    document.getElementById('inscriptionForm').addEventListener('submit', async e => {
      e.preventDefault();
      if (pad1.isEmpty() || pad2.isEmpty()) return alert('Veuillez signer les deux documents');

      const fd = new FormData(e.target);
      fd.set('signatureDroitImage', pad1.toDataURL());
      fd.set('signatureSanitaire', pad2.toDataURL());
      fd.append('luEtApprouveDroitImageText', 'Lu et approuvé');
      fd.append('luEtApprouveInscriptionText', 'Lu et approuvé');
      fd.append('lieuInscription', 'Cluses');

      const res = await fetch('/inscription', { method: 'POST', body: fd });
      const json = await res.json();
      const result = document.getElementById('result');

      if (json.success) {
        result.innerHTML = `<div class="success">
          Inscription enregistrée !<br>
          <a href="${json.pdfUrl}" target="_blank">Autorisation</a> |
          <a href="${json.sanitaryPdfUrl}" target="_blank">Fiche sanitaire</a>
        </div>`;
      } else {
        result.innerHTML = `<div class="error">${json.message}</div>`;
      }
    });
  </script>
</body>
</html>



